% A ConTeXt document [master document: joylol.tex]

\startchapter[title=Lakefile]

We use a slightly updated version of Steve Donovan's Lakefile tool to 
drive the creation of the various files required by any given 
\type{joylol} interpreter. 

\startLakefile
-- A Lua Lakefile

local docDir    = 'doc'
local moduleDir = 'build'
local srcFiles = {
  docDir..'/joylol.tex',
  docDir..'/overview.tex',
  docDir..'/preamble.tex',
  docDir..'/lakefile.tex'
}

local joylolDoc = 
  'cd '..docDir..' ; context joylol.tex'

# this is a test
  
local moduleTargets = {
  'joylol'
}

local buildTargets   = { }
local installTargets = { }

for i, aTarget in ipairs(moduleTargets) do

  table.insert(buildTargets, target(
    'build/'..aTarget,
    srcFiles,
    joylolDoc
  ))

  table.insert(installTargets, target(
    installDir..'/'..aTarget,
    'build/'..aTarget,
    'cp $(DEPENDS) $(TARGET)'
  ))
end

table.insert(buildTargets, target(
  'build/lakefile',
  srcFiles,
  joylolDoc
))

table.insert(installTargets, target(
  'lakefile',
  'build/lakefile',
  'cp $(DEPENDS) $(TARGET)'
))

target('install', installTargets)

default(buildTargets)
\stopLakefile

\createLakefileFile%
  {default}%
  {../build/lakefile}%
  {}

\stopchapter