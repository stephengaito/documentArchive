% A ConTeXt document [master document: ../joyLoL.tex]

\startJoyLoLCoAlg[title=C-Functions][cFunctions]

\srcCopyrightCCBYSA[title={JoyLoL}, url=https://perceptisys.co.uk, 
src=https://github.com/stephengaito/joylol, author={Perceptisys Ltd 
(Stephen Gaito)}, year=2017] 

\targetCopyrightMIT[author={PerceptiSys Ltd (Stephen Gaito)}, year=2017]

\startsection[title=Goals]

A C-Function represents a JoyLoL word implemented as an ANSI-C function 
which directly manipulates a Context. 

\dependsOn[coAlgebras]
\dependsOn[context]
\dependsOn[boolean]

\startCHeader

typedef void (CFunction)(Context*);

typedef struct cFunction_struct {
  CoAlgebras super;
  CFunction  theFunction;
} CFunction;

\stopCHeader

\startJoyLoLWord[isCFunction]

\preProcessStack[aCFunc][]
\postDataStack[isBoolean]

\startCCode

if (!aCFunc) then
  pushDataFalse(aCtx);
if (aCFunc->isA == CFUNCTIONS_COALG) then
  pushDataTrue(aCtx);
pushDataFalse(aCtx);

\stopCCode

\stopJoyLoLWord

\startJoyLoLWord[executeCFunc]

\preProcessStack[aCFunc][]

\startCCode

if (!aCFunc) then
  raiseException(aCtx, "no atom (CFunction)");
if (aCFunc->super.isA != CFUNCTIONS_COALG) then
  raiseException(aCtx, "not a CFunction");
if (!aCFunc->theFunction) then
  raiseException(aCtx, "no CFunction found");

(aCFunc->theFunction)(aCtx);

\stopCCode

\stopJoyLoLWord

\stopsection

\stopJoyLoLCoAlg
