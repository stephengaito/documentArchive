% A ConTeXt document [master document: jInterps.tex]

\section[title=Printer]

\startCCode
// We need to protect our list walking printer from the possibility that a
// structure (and dictionaries will be) contain cycles...
//
// We do this by re-using the garbage collector's mark-sweep bit.
// This is crude and will certainly need to be chaged at some point...
// but it should work now... the likely future change will be to add
// further fields to the PairAtom structure.
// (or to use a hash table).
\stopCCode

\startCHeader
extern void printLoLDebug(
  StringBufferObj *aStrBuf,
  CoAlgObj        *aLoL,
  Boolean          debugFlag
);

#define printLoL(aStrBuf, aLoL)       \
  printLoLDebug(aStrBuf,  aLoL, FALSE)
\stopCHeader

\startCCode
void printLoLDebug(
  StringBufferObj *aStrBuf,
  CoAlgObj        *aLoL, 
  Boolean          debugFlag
) {
  //  debugFlag = TRUE;
  DEBUG(debugFlag, "printLoL %p %p\n", aStrBuf, aLoL);

  if (aLoL) {
    assert(asType(aLoL));
    Boolean result = (asType(aLoL)->printStr)(aStrBuf, aLoL);
    assert(result);
  }
}
\stopCCode