-- A Lua Make System file

lfs = require 'lfs'

lfs.mkdir('build')
lfs.mkdir('build/joylol')
lfs.mkdir('install')
lfs.mkdir('install/joylol')

require 'lms.litProgs'

litProgs.targets{
  mainDoc  = 'jInterps.tex',
  docFiles = {
    'overview.tex',
    'objects.tex',
    'interpreter.tex',
    'printer.tex',
    'words.tex',
    'luaInterface.tex',
    'luaScript.tex',
    'conclusion.tex',
  },
  srcFiles = {
    'joylol.lua',
    'joylol/jInterps.h',
    'joylol/jInterps-private.h',
    'objects.c',
    'interpreter.c',
    'words.c',
    'lua.c',
  },
  buildDir  = 'build',
  docDir    = 'doc',
  moduleDir = 'install',
}

require 'lms.joyLoL'

joylol.targets{
  coAlgs = {
    'jInterps',
  },
  srcFiles = {
    'joylol.lua',
    'joylol/jInterps.h',
    'joylol/jInterps-private.h',
    'objects.c',
    'interpreter.c',
    'words.c',
    'lua.c',
  },
  coAlgLibs = {
  },
  buildDir = 'build',
}

require 'lms.contests'

contests.targets{
  testExecs = {
    'allCTests',
  },
  mainDoc = 'jInterps.tex',
  docFiles = {
    'overview.tex',
    'objects.tex',
    'interpreter.tex',
    'printer.tex',
    'words.tex',
    'luaInterface.tex',
    'luaScript.tex',
    'conclusion.tex',
  },
  srcFiles = {
    'joylol.lua',
    'joylol/jInterps.h',
    'joylol/jInterps-private.h',
    'objects.c',
    'interpreter.c',
    'words.c',
    'lua.c',
  },
  testLibDirs = {
  },
  testLibs = {
  },
  buildDir  = 'build',
  docDir    = 'doc',
  moduleDir = 'install',
}

local joylolTarget = makePath{getEnv('HOME'), '.joylol', 'joylol.lua'}
local joylolDep    = makePath{'build', 'joylol.lua'}
tInsert(installTargets, target{
  target       = joylolTarget,
  dependencies = { joylolDep },
  command      = tConcat({'install -T', joylolDep, joylolTarget }, ' ')
})