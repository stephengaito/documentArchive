% A ConTeXt document [master document: dictNodes.tex]

\section[title=Rotate]

\setCHeaderStream{private}

\startCHeader
extern DictNodeObj* rotateLeft(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
);
\stopCHeader

\startCCode
DictNodeObj* rotateLeft(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
) {
  assert(aDict);
  JoyLoLInterp *jInterp = aDict->jInterp;
  assert(jInterp);
  
  StringBufferObj *aStrBuf =
    (jInterp->debug ? newStringBuffer(jInterp) : NULL);
  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, ">-rotateLeft %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  assert(anAVLNode->right);

  DictNodeObj* newRoot = anAVLNode->right;
  anAVLNode->right = newRoot->left;
  newRoot->left    = anAVLNode;

  reCalculateAVLNodeHeightBalance(anAVLNode);
  reCalculateAVLNodeHeightBalance(newRoot);

  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "<o-rotateLeft %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
    printDicInto(jInterp, aStrBuf, newRoot);
    DEBUG(jInterp, "<n-rotateLeft %p %ld:%zu=%zu %s\n",
          newRoot, newRoot->balance, newRoot->height,
          deepCalculateAVLNodeHeight(newRoot),
          getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  assert(anAVLNode->height == deepCalculateAVLNodeHeight(anAVLNode));
  assert(newRoot->height == deepCalculateAVLNodeHeight(newRoot));
  return newRoot;
}
\stopCCode

\startCHeader
extern DictNodeObj* rotateRight(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
);
\stopCHeader

\startCCode
DictNodeObj* rotateRight(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
) {
  assert(aDict);
  JoyLoLInterp *jInterp = aDict->jInterp;
  assert(jInterp);
  
  StringBufferObj *aStrBuf =
    (jInterp->debug ? newStringBuffer(jInterp) : NULL);
  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, ">-rotateRight %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  assert(anAVLNode->left);

  DictNodeObj* newRoot = anAVLNode->left;
  anAVLNode->left = newRoot->right;
  newRoot->right  = anAVLNode;

  reCalculateAVLNodeHeightBalance(anAVLNode);
  reCalculateAVLNodeHeightBalance(newRoot);

  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "<o-rotateRight %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
    printDicInto(jInterp, aStrBuf, newRoot);
    DEBUG(jInterp, "<n-rotateRight %p %ld:%zu=%zu %s\n",
          newRoot, newRoot->balance, newRoot->height,
          deepCalculateAVLNodeHeight(newRoot),
          getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  assert(anAVLNode->height == deepCalculateAVLNodeHeight(anAVLNode));
  assert(newRoot->height == deepCalculateAVLNodeHeight(newRoot));
  return newRoot;
}
\stopCCode

\startCHeader
extern DictNodeObj* rotateLeftLeft(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
);
\stopCHeader

\startCCode
DictNodeObj* rotateLeftLeft(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
) {
  assert(aDict);
  JoyLoLInterp *jInterp = aDict->jInterp;
  assert(jInterp);
  
  if (jInterp->debug) {
    StringBufferObj *aStrBuf = newStringBuffer(jInterp);
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "LL %p %s\n",
      anAVLNode, getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  return rotateRight(aDict, anAVLNode);
}
\stopCCode

\startCHeader
extern DictNodeObj* rotateLeftRight(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
);
\stopCHeader

\startCCode
DictNodeObj* rotateLeftRight(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
) {
  assert(aDict);
  JoyLoLInterp *jInterp = aDict->jInterp;
  assert(jInterp);
  
  StringBufferObj *aStrBuf =
    (jInterp->debug ? newStringBuffer(jInterp) : NULL);
  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "0-LR %p %s\n",
      anAVLNode, getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  anAVLNode->left = rotateLeft(aDict, anAVLNode->left);
  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "1-LR %p %s\n",
      anAVLNode, getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  return rotateRight(aDict, anAVLNode);
}
\stopCCode

\startCHeader
extern DictNodeObj* rotateRightLeft(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
);
\stopCHeader

\startCCode
DictNodeObj* rotateRightLeft(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
) {
  assert(aDict);
  JoyLoLInterp *jInterp = aDict->jInterp;
  assert(jInterp);
  
  StringBufferObj *aStrBuf =
    (jInterp->debug ? newStringBuffer(jInterp) : NULL);
  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "0-RL %p %s\n",
      anAVLNode, getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  anAVLNode->right = rotateRight(aDict, anAVLNode->right);
  if (jInterp->debug) {
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "1-RL %p %s\n",
      anAVLNode, getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  return rotateLeft(aDict, anAVLNode);
}
\stopCCode

\startCHeader
extern DictNodeObj* rotateRightRight(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
);
\stopCHeader

\startCCode
DictNodeObj* rotateRightRight(
  DictObj     *aDict,
  DictNodeObj *anAVLNode
) {
  assert(aDict);
  JoyLoLInterp *jInterp = aDict->jInterp;
  assert(jInterp);
  
  if (jInterp->debug) {
    StringBufferObj *aStrBuf = newStringBuffer(jInterp);
    printDicInto(jInterp, aStrBuf, anAVLNode);
    DEBUG(jInterp, "RR %p %s\n",
      anAVLNode, getCString(jInterp, aStrBuf));
    strBufClose(jInterp, aStrBuf);
  }
  return rotateLeft(aDict, anAVLNode);
}
\stopCCode

\setCHeaderStream{public}
