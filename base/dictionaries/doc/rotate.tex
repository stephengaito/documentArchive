% A ConTeXt document [master document: dictionaries.tex]

\section[title=Rotate]

\setCHeaderStream{private}

\startCHeader
extern DictObj* rotateLeft(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
);
\stopCHeader

\startCCode
DictObj* rotateLeft(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
) {
  Boolean debugFlag = FALSE;
  StringBufferObj *aStrBuf =
    (debugFlag? newStringBuffer(jInterp) : NULL);
  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, ">-rotateLeft %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  assert(anAVLNode->right);

  DictObj* newRoot = anAVLNode->right;
  anAVLNode->right = newRoot->left;
  newRoot->left    = anAVLNode;

  reCalculateAVLNodeHeightBalance(anAVLNode);
  reCalculateAVLNodeHeightBalance(newRoot);

  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, "<o-rotateLeft %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(aStrBuf));
    strBufClose(aStrBuf);
    printDicInto(aStrBuf, newRoot);
    DEBUG(debugFlag, "<n-rotateLeft %p %ld:%zu=%zu %s\n",
          newRoot, newRoot->balance, newRoot->height,
          deepCalculateAVLNodeHeight(newRoot),
          getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  assert(anAVLNode->height == deepCalculateAVLNodeHeight(anAVLNode));
  assert(newRoot->height == deepCalculateAVLNodeHeight(newRoot));
  return newRoot;
}
\stopCCode

\startCHeader
extern DictObj* rotateRight(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
);
\stopCHeader

\startCCode
DictObj* rotateRight(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
) {
  Boolean debugFlag = FALSE;
  StringBufferObj *aStrBuf =
    (debugFlag? newStringBuffer(jInterp) : NULL);
  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, ">-rotateRight %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  assert(anAVLNode->left);

  DictObj* newRoot = anAVLNode->left;
  anAVLNode->left = newRoot->right;
  newRoot->right  = anAVLNode;

  reCalculateAVLNodeHeightBalance(anAVLNode);
  reCalculateAVLNodeHeightBalance(newRoot);

  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, "<o-rotateRight %p %ld:%zu=%zu %s\n",
          anAVLNode, anAVLNode->balance, anAVLNode->height,
          deepCalculateAVLNodeHeight(anAVLNode),
          getCString(aStrBuf));
    strBufClose(aStrBuf);
    printDicInto(aStrBuf, newRoot);
    DEBUG(FALSE, "<n-rotateRight %p %ld:%zu=%zu %s\n",
          newRoot, newRoot->balance, newRoot->height,
          deepCalculateAVLNodeHeight(newRoot),
          getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  assert(anAVLNode->height == deepCalculateAVLNodeHeight(anAVLNode));
  assert(newRoot->height == deepCalculateAVLNodeHeight(newRoot));
  return newRoot;
}
\stopCCode

\startCHeader
extern DictObj* rotateLeftLeft(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
);
\stopCHeader

\startCCode
DictObj* rotateLeftLeft(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
) {
  Boolean debugFlag = FALSE;
  if (debugFlag) {
    StringBufferObj *aStrBuf = newStringBuffer(jInterp);
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, "LL %p %s\n",
      anAVLNode, getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  return rotateRight(jInterp, anAVLNode);
}
\stopCCode

\startCHeader
extern DictObj* rotateLeftRight(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
);
\stopCHeader

\startCCode
DictObj* rotateLeftRight(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
) {
  Boolean debugFlag = FALSE;
  StringBufferObj *aStrBuf =
    (debugFlag ? newStringBuffer(jInterp) : NULL);
  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, "0-LR %p %s\n",
      anAVLNode, getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  anAVLNode->left = rotateLeft(jInterp, anAVLNode->left);
  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, "1-LR %p %s\n",
      anAVLNode, getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  return rotateRight(jInterp, anAVLNode);
}
\stopCCode

\startCHeader
extern DictObj* rotateRightLeft(
  JoyLoLInterp *jInterp,
  DictObj* anAVLNode
);
\stopCHeader

\startCCode
DictObj* rotateRightLeft(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
) {
  Boolean debugFlag = FALSE;
  StringBufferObj *aStrBuf =
    (debugFlag ? newStringBuffer(jInterp) : NULL);
  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(debugFlag, "0-RL %p %s\n",
      anAVLNode, getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  anAVLNode->right = rotateRight(jInterp, anAVLNode->right);
  if (debugFlag) {
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(FALSE, "1-RL %p %s\n",
      anAVLNode, getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  return rotateLeft(jInterp, anAVLNode);
}
\stopCCode

\startCHeader
extern DictObj* rotateRightRight(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
);
\stopCHeader

\startCCode
DictObj* rotateRightRight(
  JoyLoLInterp *jInterp,
  DictObj      *anAVLNode
) {
  Boolean debugFlag = FALSE;
  if (debugFlag) {
    StringBufferObj *aStrBuf = newStringBuffer(jInterp);
    printDicInto(aStrBuf, anAVLNode);
    DEBUG(FALSE, "RR %p %s\n",
      anAVLNode, getCString(aStrBuf));
    strBufClose(aStrBuf);
  }
  return rotateLeft(jInterp, anAVLNode);
}
\stopCCode

\setCHeaderStream{public}
