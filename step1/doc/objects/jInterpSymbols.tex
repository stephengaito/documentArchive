% A ConTeXt document [master document: ../jInterp.tex ]

\subsection[title=Symbols]

\startTestSuite[appendSymbols]

\startCCode
char *appendSymbols(Symbol *sym1, Symbol *sym2) {
  char *newSym =
    (char*)calloc(
      strlen(sym1)+strlen(sym2)+1,
      sizeof(char)
    );
  assert(newSym);
  strcpy(newSym, sym1);
  strcat(newSym, sym2);
  return newSym;
}
\stopCCode

\startTestCase[should append two symbols]

\startCTest
  Symbol* newSymb = appendSymbols("prefix-", "-suffix");
  AssertStrEquals(newSymb, "prefix--suffix");
\stopCTest
\stopTestCase
\stopTestSuite

\startCHeader
typedef struct symbol_struct {
  size_t  tag;
  Symbol *symbol;
} SymbolObj;

#define isSymbolObj(anObj) ((anObj) && (((JObj*)(anObj))->tag == SymbolTag))
#define asSymbolObj(anObj) ((SymbolObj*)(anObj))
#define asSymbol(anObj)    (((SymbolObj*)(anObj))->symbol)
\stopCHeader

\startTestSuite[newSymbol]

\startCHeader
SymbolObj *newSymbol(Symbol *aSymbol);
\stopCHeader

\startCCode
SymbolObj *newSymbol(Symbol *aSymbol) {
  SymbolObj *newObj =
    (SymbolObj*)calloc(1, sizeof(SymbolObj));
  newObj->tag    = SymbolTag;
  newObj->symbol = strdup(aSymbol);
  return newObj;
}
\stopCCode

\startTestCase[should create a new symbol]

\startCTest
  SymbolObj* aSymb = newSymbol("This is a test");
  AssertIntTrue(isSymbolObj(aSymb));
  AssertIntEquals(getJObjTag(aSymb), SymbolTag);
  AssertStrEquals(asSymbol(aSymb), "This is a test");
\stopCTest
\stopTestCase
\stopTestSuite

\startTestSuite[symbolPrinter]

\startCHeader
void symbolPrinter(JObj *anObj, Symbol *indent, size_t timeToLive);
\stopCHeader

\startCCode
void symbolPrinter(JObj *anObj, Symbol *indent, size_t timeToLive) {
  DEBUG(DebugMask, "symbolPrinter %p\n", anObj);
  assert(isSymbolObj(anObj));
  printf("%s%s\n", indent, asSymbol(anObj));
}
\stopCCode

\startTestCase[should print a symbol]

\skipTestCase
\stopTestSuite