% A ConTeXt document [master document: contexts.tex]

\section[title=JoyLoL operators]

In this section we develop the primary JoyLoL operators. These operators 
are modelled upon those used by Manfred von Thun in his language Joy, 
\cite{vonThun1994overview}. We will implement his full range of unary, 
binary and ternary operators as defined in the \quote{General Operators} 
section of \cite{vonThun1995atomicPrograms}. We provide a duplicate set 
for each of the data and process stacks of a given context. We will also 
provide a set which transfer items between the data and process stacks. We 
will use slightly more mnemonic names. 

\subsection[title=Unary operators]

\startCCode
static void pop1DAP(ContextObj* aCtx) {
  popCtxData(aCtx);
}
\stopCCode

\startCCode
static void pop1PAP(ContextObj* aCtx) {
  popCtxProcess(aCtx);
}
\stopCCode


\startCCode
static void dup1DAP(ContextObj* aCtx) {
  peekCtxDataInto(aCtx, top);
  pushCtxData(aCtx, copyLoL(top));
}
\stopCCode

\startCCode
static void dup1PAP(ContextObj* aCtx) {
  peekCtxProcessInto(aCtx, top);
  pushCtxProcess(aCtx, copyLoL(top));
}
\stopCCode

\subsection[title=Binary operators]

\startCCode
static void swap12DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  pushCtxData(aCtx, top);
  pushCtxData(aCtx, second);
}
\stopCCode

\startCCode
static void swap12PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  pushCtxProcess(aCtx, top);
  pushCtxProcess(aCtx, second);
}
\stopCCode

\startCCode
static void pop2DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxData(aCtx);
  pushCtxData(aCtx, top);
}
\stopCCode

\startCCode
static void pop2PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcess(aCtx);
  pushCtxProcess(aCtx, top);
}
\stopCCode

\startCCode
static void pop12DAP(ContextObj* aCtx) {
  popCtxData(aCtx);
  popCtxData(aCtx);
}
\stopCCode

\startCCode
static void pop12PAP(ContextObj* aCtx) {
  popCtxProcess(aCtx);
  popCtxProcess(aCtx);
}
\stopCCode

\startCCode
static void dup2DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, copyLoL(second));
  pushCtxData(aCtx, top);
}
\stopCCode

\startCCode
static void dup2PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  pushCtxProcess(aCtx, second);
  pushCtxProcess(aCtx, copyLoL(second));
  pushCtxProcess(aCtx, top);
}
\stopCCode

\subsection[title=Ternary operators]

\startCCode
static void swap13DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  pushCtxData(aCtx, top);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, third);
}
\stopCCode

\startCCode
static void swap13PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  popCtxProcessInto(aCtx, third);
  pushCtxProcess(aCtx, top);
  pushCtxProcess(aCtx, second);
  pushCtxProcess(aCtx, third);
}
\stopCCode

\startCCode
static void swap23DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, third);
  pushCtxData(aCtx, top);
}
\stopCCode

\startCCode
static void swap23PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  popCtxProcessInto(aCtx, third);
  pushCtxProcess(aCtx, second);
  pushCtxProcess(aCtx, third);
  pushCtxProcess(aCtx, top);
}
\stopCCode

\startCCode
static void rollUp3DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  pushCtxData(aCtx, top);
  pushCtxData(aCtx, third);
  pushCtxData(aCtx, second);
}
\stopCCode

\startCCode
static void rollUp3PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  popCtxProcessInto(aCtx, third);
  pushCtxProcess(aCtx, top);
  pushCtxProcess(aCtx, third);
  pushCtxProcess(aCtx, second);
}
\stopCCode

\startCCode
static void rollDown3DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, top);
  pushCtxData(aCtx, third);
}
\stopCCode

\startCCode
static void rollDown3PAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  popCtxProcessInto(aCtx, third);
  pushCtxProcess(aCtx, second);
  pushCtxProcess(aCtx, top);
  pushCtxProcess(aCtx, third);
}
\stopCCode

\startCCode
static void choiceDAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  if (isTrueObj(top)) {
    pushCtxData(aCtx, second);
  } else {
    pushCtxData(aCtx, third);
  }
}
\stopCCode

\startCCode
static void choicePAP(ContextObj* aCtx) {
  popCtxProcessInto(aCtx, top);
  popCtxProcessInto(aCtx, second);
  popCtxProcessInto(aCtx, third);
  if (isTrueObj(top)) {
    pushCtxProcess(aCtx, second);
  } else {
    pushCtxProcess(aCtx, third);
  }
}
\stopCCode

\subsection[title=Quaternary operators]

\startCCode
static void swap14DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  popCtxDataInto(aCtx, fourth);
  pushCtxData(aCtx, top);
  pushCtxData(aCtx, third);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, fourth);
}
\stopCCode

\startCCode
static void swap24DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  popCtxDataInto(aCtx, fourth);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, third);
  pushCtxData(aCtx, fourth);
  pushCtxData(aCtx, top);
}
\stopCCode

\startCCode
static void swap34DAP(ContextObj* aCtx) {
  popCtxDataInto(aCtx, top);
  popCtxDataInto(aCtx, second);
  popCtxDataInto(aCtx, third);
  popCtxDataInto(aCtx, fourth);
  pushCtxData(aCtx, third);
  pushCtxData(aCtx, fourth);
  pushCtxData(aCtx, second);
  pushCtxData(aCtx, top);
}
\stopCCode

\subsection[title=Registering operators]

\startCCode
void initContextAOOperators(ContextObj *aCtx) {
  assert(isContextObj(aCtx));
  SymbolTableObj *symTab = asCtxSymbols(aCtx);
  
  // unary operators
  registerCFunction(symTab, "pop1D", pop1DAP);
  registerCFunction(symTab, "pop1P", pop1PAP);
  registerCFunction(symTab, "dup1D", dup1DAP);
  registerCFunction(symTab, "dup1P", dup1PAP);
  //
  // binary operators
  //
  registerCFunction(symTab, "swap12D", swap12DAP);
  registerCFunction(symTab, "swap12P", swap12PAP);
  registerCFunction(symTab, "pop2D",   pop2DAP);
  registerCFunction(symTab, "pop2P",   pop2PAP);
  registerCFunction(symTab, "pop12D",  pop12DAP);
  registerCFunction(symTab, "pop12P",  pop12PAP);
  registerCFunction(symTab, "dup2D",   dup2DAP);
  registerCFunction(symTab, "dup2P",   dup2PAP);
  //
  // ternary operators
  //
  registerCFunction(symTab, "swap13D",    swap13DAP);
  registerCFunction(symTab, "swap13P",    swap13PAP);
  registerCFunction(symTab, "swap23D",    swap23DAP);
  registerCFunction(symTab, "swap23P",    swap23PAP);
  registerCFunction(symTab, "rollUp3D",   rollUp3DAP);
  registerCFunction(symTab, "rollUp3P",   rollUp3PAP);
  registerCFunction(symTab, "rollDown3D", rollDown3DAP);
  registerCFunction(symTab, "rollDown3P", rollDown3PAP);
  registerCFunction(symTab, "choiceD",    choiceDAP);
  registerCFunction(symTab, "choiceP",    choicePAP);
  //
  // quarternary operators
  //
  registerCFunction(symTab, "swap14D", swap14DAP);
  registerCFunction(symTab, "swap24D", swap24DAP);
  registerCFunction(symTab, "swap34D", swap34DAP);
}
\stopCCode
